:root {
  /* Main Theme Colors */
  --color-bg-main: #1b214e; /* body bg */
  --color-bg-alt: #232a4d; /* modal bg, alt */
  --color-bg-container: #293165; /* container bg */
  --color-bg-translucent: rgba(14, 14, 22, 0.6);
  --color-bg-footer: rgba(34, 37, 60, 0.75);
  --color-bg-footer-catalyst: rgba(34, 37, 60, 0.45);
  --color-bg-footer-border: #fff;
  --color-bg-drop: #6f55b6;

  /* Violet/Purple Accent */
  --color-accent: #6f55b6;
  --color-accent-hover: #825eff;
  --color-accent-border: #5f559a;
  --color-accent-focus: #9e81fa;

  /* Shape/Gradient Colors */
  --color-shape: #323c6f;
  --color-shape2: #3a5580;
  --color-shape-diamond: #fff;
  --color-shape-diamond-alt: #67564c;

  /* Text/Font */
  --color-text: #eeeeee;
  --color-text-muted: #bbb;
  --color-footer-text: #fff;
  --color-label: #ececec;
  --color-h1: #fff;

  /* Misc UI */
  --color-border: #ccc;
  --color-shadow: rgba(0, 0, 0, 0.08);
  --color-shadow-strong: #2e205999;
  --color-modal-bg: rgba(18, 18, 40, 0.85);
  --color-modal-date: #bbe;
  --rect-color: #825eff;

  /* Tag colors */
  --tag-update: #ff4b4b;
  --tag-version: #2fd46c;
  --tag-beta: #ad7aff;
  --tag-alpha: #49baff;

  /* Misc */
  --radius: 10px;
  --radius-large: 16px;
  --blur-bg: blur(8px);
}

/* setting pulse glow colour to change */
.pulse-rect {
  stroke: var(--rect-color);
}

/* ---- theme: catalyst ---- */
body.theme-catalyst {
  --color-bg-main: #32149b;
  --color-bg-container: rgba(14, 14, 22, 0.6);
  --color-bg-alt: rgba(14, 14, 22, 0.8);

  --color-accent: #310b54;
  --color-accent-hover: #511247;
  --color-accent-focus: #4d1498;
  --color-accent-border: #5d11bd;

  --color-input: #c74cfd;
  --color-splash-text: #ff6fd8;
  --color-bg-drop: #5d11bd;
  --rect-color: #c74cfd;

  --color-quiz-selector: rgba(14, 14, 22, 0.9);
}

/* also previously nested lol */
body.theme-catalyst #quizScreen,
body.theme-catalyst #resultsScreen,
body.theme-catalyst #reviewScreen,
body.theme-catalyst .container.bg {
  background: var(--color-bg-container) !important;
  transition: background 0.3s ease;
}

/* ---- theme: dark ---- */
body.theme-dark {
  --color-bg-main: #181f30;
  --color-bg-container: #141a2b;
  --color-bg-alt: #181f30;

  --color-accent: #1a9fc8;
  --color-accent-hover: #109294;
  --color-accent-focus: #23a9f6;
  --color-accent-border: #23d6e0;
  --color-accent-selected: #23a9f6;

  --color-text: #e9eefa;
  --color-shape: #2e3d54;
  --color-shape2: #294065;
  --color-shape-diamond: #3b7cc0;
  --color-shape-diamond-alt: #f5f7fa;

  --color-input: #23a9f6;
  --color-splash-text: #23a9f6;
  --color-bg-drop: #23d6e0;
  --rect-color: #e0d6ff;

  --color-question-count: #181f30;
  --color-quiz-selector: var(--color-bg-container);
}

/* ---- theme: light ---- */
body.theme-light {
  --color-bg-main: #f6f9fa;
  --color-bg-container: #e9ebf0;
  --color-bg-alt: #f3f4f7;

  --color-accent: #ff7d36;
  --color-accent-hover: #ff9652;
  --color-accent-focus: #4eb3f2;
  --color-accent-border: #ff9652;
  --color-accent-selected: #f16100;
  --settings-border: #21232a;

  --color-text: #21232a;
  --color-text-muted: #777777;
  --color-h1: #21232a;
  --color-shape: #d3d6db;
  --color-shape2: #4eb3f2;
  --color-shape-diamond: #4eb3f2;
  --color-shape-diamond-alt: #ff7d36;

  --color-input: #ff7d36;
  --color-splash-text: #ff7d36;
  --color-bg-drop: #ff9652;
  --rect-color: #53d2fa;

  --theme-bg: #e9ebf0;
  --color-question-count: #d3d6db;
  --color-quiz-selector: rgba(233, 235, 240, 0.88);
}

/* these were nested originally, flattened them so they actually apply */
body.theme-light h2 {
  color: #21232a;
}
body.theme-light .large-modal-content {
  color: #21232a;
}

/* ---- theme: rain ---- */
body.theme-rain {
  --color-bg-container: rgba(38, 48, 56, 0.38);
  --color-bg-main: #3e7d8c;
  --color-bg-alt: rgba(38, 48, 56, 0.38);

  --color-accent: #2b6471;
  --color-accent-hover: #3a7b8a;
  --color-accent-focus: #5b98a6;
  --color-accent-border: #3a7b8a;
  --color-accent-selected: #649daa;

  --color-input: #6ca2ae;
  --color-splash-text: #7cf9fc;
  --color-bg-drop: #3a7b8a;
  --rect-color: #7cf9fc;

  --color-quiz-selector: rgba(38, 48, 56, 0.88);
  --color-question-count: rgba(38, 48, 56, 0.88);
  --theme-bg: #2b3f48;

  --settings-border: rgba(255, 255, 255, 0.7);

  /* glasseous look */
  border-radius: 18px;
  box-shadow: 0 8px 32px 0 rgba(24, 32, 60, 0.16);
  backdrop-filter: blur(9px) saturate(1.18);
  -webkit-backdrop-filter: blur(9px) saturate(1.18);
}

/* ---- halloween theme ---- */
body.theme-halloween {
  --color-bg-main: rgba(20,19,34,0.84);              
  --color-bg-container: #141322;        
  --color-bg-alt: #141322;

  --color-accent: #ff7a00;             
  --color-accent-hover: #ff9933;
  --color-accent-focus: #ffd166;
  --color-accent-border: #9c4a00;
  --color-accent-selected: #ffd166;

  --color-text: #f6f1e9;               
  --color-text-muted: #c9c5bd;
  --color-h1: #ffe8c2;
  --color-shape: #1b1a2d;
  --color-shape2: #26233e;

  --color-quiz-selector: rgba(20,19,34,.88);
  --color-question-count: rgba(20,19,34,.88);
  --color-bg-drop: #9c4a00;
  --rect-color: #ff7a00;
}

/* overlay container */
.halloween-shapes {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 30;
}

/* each ghost */
.halloween-shapes .h-shape {
  position: absolute;
  width: var(--size, 64px);
  height: var(--size, 64px);
  transform: translate(-50%, -50%);
  opacity: var(--alpha, 0.26);
  animation:
    ghostMotion var(--dur, 18s) ease-in-out infinite,
    ghostBreathe var(--breathe, 5.5s) ease-in-out infinite;
}

/* drift/bob */
@keyframes ghostMotion {
  0% {
    transform:
      translate(calc(var(--x, 50) * 1vw), calc(var(--y, 50) * 1vh))
      translate(-50%, -50%)
      translateX(calc(var(--amp, 12px) * -1))
      translateY(0)
      rotate(var(--r0, -3deg))
      scale(1);
  }
  25% {
    transform:
      translate(calc(var(--x) * 1vw), calc(var(--y) * 1vh))
      translate(-50%, -50%)
      translateX(0)
      translateY(-12px)
      rotate(0deg)
      scale(1);
  }
  50% {
    transform:
      translate(calc(var(--x) * 1vw), calc(var(--y) * 1vh))
      translate(-50%, -50%)
      translateX(calc(var(--amp)))
      translateY(0)
      rotate(var(--r1, 3deg))
      scale(1);
  }
  75% {
    transform:
      translate(calc(var(--x) * 1vw), calc(var(--y) * 1vh))
      translate(-50%, -50%)
      translateX(0)
      translateY(12px)
      rotate(0deg)
      scale(1);
  }
  100% {
    transform:
      translate(calc(var(--x) * 1vw), calc(var(--y) * 1vh))
      translate(-50%, -50%)
      translateX(calc(var(--amp) * -1))
      translateY(0)
      rotate(var(--r0, -3deg))
      scale(1);
  }
}

/* pause during despawn */
.halloween-shapes .h-shape.is-frozen {
  animation-play-state: paused, paused;
}

/* echo clone grow/fade */
.halloween-shapes .h-shape .ghost-echo {
  pointer-events: none;
  opacity: 0.35;
  transform-origin: 50% 50%;
  animation: echo-pop 900ms ease-out forwards;
}
@keyframes echo-pop {
  0%   { transform: scale(1.00); opacity: 0.45; }
  30%  { transform: scale(1.20); opacity: 0.38; }
  100% { transform: scale(1.70); opacity: 0; }
}

/* fade the original */
.halloween-shapes .h-shape .ghost-main.fade-out {
  animation: ghost-fade 650ms ease-in 250ms forwards;
}
@keyframes ghost-fade {
  to { opacity: 0; filter: blur(1px); }
}

/* svg sizing */
.halloween-shapes .h-shape > svg.ghost-main,
.halloween-shapes .h-shape > svg.ghost-echo {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  display: block;
  overflow: visible;
}
.halloween-shapes .h-shape > svg.ghost-echo {
  transform-box: fill-box;
  transform-origin: 50% 50%;
}
/* shiny variant */
.halloween-shapes svg.ghost-main.is-shiny {
  filter: invert(1) hue-rotate(180deg);
}

/* subtle opacity breathing (optional look, but cheap) */
@keyframes ghostBreathe {
  0%, 100% { opacity: calc(var(--alpha, 0.26) * 0.85); }
  50%      { opacity: calc(var(--alpha, 0.26) * 1.15); }
}

/* mouth swap (JS toggles .show-tongue on the svg) */
.halloween-shapes svg.ghost-main .mouth-tongue { display: none; }
.halloween-shapes svg.ghost-main.show-tongue .mouth-normal { display: none; }
.halloween-shapes svg.ghost-main.show-tongue .mouth-tongue { display: inline; }

/* arm swap during scare (JS toggles .is-despawning on the svg) */
.halloween-shapes svg.ghost-main .boo-arms--out { display: none; }
.halloween-shapes svg.ghost-main.is-despawning .boo-arms--out { display: inline; }
.halloween-shapes svg.ghost-main.is-despawning .boo-arms--in  { display: none; }

/* -- corner webs -- */
.h-webs-layer{position:fixed;inset:0;pointer-events:none;z-index:2;}
.h-web{position:absolute;width:22vmin;height:22vmin;opacity:.18;}
.h-web--tr{top:0;right:0;}
.h-web--bl{bottom:0;left:0;}

.h-web svg{width:100%;height:100%;display:block;}
.h-web .stroke{
  stroke:rgba(255,255,255,.95);
  stroke-width:1.5;
  fill:none;
  vector-effect:non-scaling-stroke;
  filter:drop-shadow(0 0 2px rgba(255,255,255,.35));
}

/* tweak size/opacity 
   .h-web{width:18vmin;height:18vmin;opacity:.22;} */

/* bats overlay */
.bats-layer {
  position: fixed;
  inset: 0;
  pointer-events: hidden;
  z-index: 1001;
}
.bats-layer.hidden { display: hidden; }
.bats-layer video { display: hidden; }
.bats-layer canvas { width: 100%; height: 100%; display: block; }


/* ---- global theme hooks ---- */
body {
  background: var(--color-bg-main) !important;
}
.quiz-footer {
  background: var(--color-bg-footer) !important;
}

/* ---- speech bubbles ---- */
.speech-bubble {
  position: absolute;
  left: 130%;
  top: 50%;
  transform: translateY(-50%);
  background: #232a4d;
  color: #fff;
  border-radius: 10px;
  padding: 7px 9px;
  font-size: 1rem;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
  white-space: pre-line;
  min-width: 260px;
  max-width: 300px;
  max-height: 70px;
  z-index: 100;
  opacity: 1;
  pointer-events: auto;
  animation: bubbleIn 0.2s;
  display: block;
}

#catalystSpeechBubble #settip,
#rainSpeechBubble #settip {
  display: flex;
  justify-content: center;
}

#rainSpeechBubble .bubble-intro {
  display: inline;
  padding: 25px;
}

.speech-bubble .bubble-arrow {
  position: absolute;
  left: -14px;
  top: 50%;
  transform: translateY(-50%);
  width: 0;
  height: 0;
  border-top: 12px solid transparent;
  border-bottom: 12px solid transparent;
  border-right: 14px solid #232a4d;
}

.speech-bubble.hidden {
  display: none;
  opacity: 0;
}

@keyframes bubbleIn {
  from {
    opacity: 0;
    transform: translateY(-50%) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(-50%) scale(1);
  }
}
